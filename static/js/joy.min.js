window.movimiento=0;
let slider = document.getElementById('slider');
let sliderValue = document.getElementById('sliderValue');

function toggleSliderActive(active) {
    slider.disabled = !active;
    sliderValue.disabled = !active;
}

slider.addEventListener('input', function() {
    if (window.movimiento !== 0) {
        sliderValue.value = this.value;
        AddData();
    } else {
        // Si window.movimiento es 0, mantener el valor del slider en 0
        this.value = 0;
        sliderValue.value = 0;
    }   
  });
  
  // Actualizar el valor del slider cuando cambie el input number
  sliderValue.addEventListener('input', function() {
    if (window.movimiento !== 0) {
        slider.value = this.value;
        AddData();
    } else {
        // Si window.movimiento es 0, mantener el valor del input number en 0
        this.value = 0;
    }
  });

document.addEventListener('keydown', function(event) {
    if (event.key === 'w') {
        window.movimiento = 8;
        console.log(movimiento);
        toggleSliderActive(true);
    }
    if (event.key === 's') {
        window.movimiento = 2;
        console.log(movimiento);
        toggleSliderActive(true);
    }
    if (event.key === 'a') {
        window.movimiento = 6;
        console.log(movimiento);
        toggleSliderActive(true);
    }
    if (event.key === 'd') {
        window.movimiento = 4;
        console.log(movimiento);
        toggleSliderActive(true);

    }if (event.key === ' ') {
        window.movimiento = 0;
        slider.value = 0; // Establecer el valor del slider en 0
        sliderValue.value = 0; // Actualizar el valor del input number
        toggleSliderActive(false);
        console.log(movimiento);
    }else{

    }
});

// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyCik-hsqM24GSvMJdtk0UysyfMvgeOMUks",
    authDomain: "basededatosprueva-79653.firebaseapp.com",
    databaseURL: "https://basededatosprueva-79653-default-rtdb.firebaseio.com",
    projectId: "basededatosprueva-79653",
    storageBucket: "basededatosprueva-79653.appspot.com",
    messagingSenderId: "984780399094",
    appId: "1:984780399094:web:838c3b4addf4fecc1127d7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

const db = getDatabase();

function AddData() {
    let ruedasNumerico = parseFloat(slider.value);
    set(ref(db, 'Buggy/'), {
        velocidades: 
        { 
            direccion: window.movimiento,
            ruedas: ruedasNumerico
        } 
    }).then(() => {
        console.log("AgregacionDatos");
    }).catch((error) => {
        alert("Unsuccessful");
        console.log(error);
    });
}

setInterval(AddData, 10);


let StickStatus={xPosition:0,yPosition:0,x:0,y:0,cardinalDirection:"C"};var JoyStick=function(t,e,i){var o=void 0===(e=e||{}).title?"joystick":e.title,n=void 0===e.width?0:e.width,a=void 0===e.height?0:e.height,r=void 0===e.internalFillColor?"#ffffff":e.internalFillColor,c=void 0===e.internalLineWidth?2:e.internalLineWidth,s=void 0===e.internalStrokeColor?"#000000":e.internalStrokeColor,d=void 0===e.externalLineWidth?2:e.externalLineWidth,u=void 0===e.externalStrokeColor?"#ffffff":e.externalStrokeColor,h=void 0===e.autoReturnToCenter||e.autoReturnToCenter;i=i||function(t){};var S=document.getElementById(t);S.style.touchAction="none";var f=document.createElement("canvas");f.id=o,0===n&&(n=S.clientWidth),0===a&&(a=S.clientHeight),f.width=n,f.height=a,S.appendChild(f);var l=f.getContext("2d"),k=0,g=2*Math.PI,x=(f.width-(f.width/2+10))/2,v=x+5,P=x+30,m=f.width/2,C=f.height/2,p=f.width/10,y=-1*p,w=f.height/10,L=-1*w,F=m,E=C;function W(){l.beginPath(),l.arc(m,C,P,0,g,!1),l.lineWidth=d,l.strokeStyle=u,l.stroke()}function T(){l.beginPath(),F<x&&(F=v),F+x>f.width&&(F=f.width-v),E<x&&(E=v),E+x>f.height&&(E=f.height-v),l.arc(F,E,x,0,g,!1);var t=l.createRadialGradient(m,C,5,m,C,200);t.addColorStop(0,r),t.addColorStop(1,s),l.fillStyle=t,l.fill(),l.lineWidth=c,l.strokeStyle=s,l.stroke()}function D(){let t="",e=F-m,i=E-C;return i>=L&&i<=w&&(t="C"),i<L&&(t="N"),i>w&&(t="S"),e<y&&("C"===t?t="W":t+="W"),e>p&&("C"===t?t="E":t+="E"),t}"ontouchstart"in document.documentElement?(f.addEventListener("touchstart",function(t){k=1},!1),document.addEventListener("touchmove",function(t){1===k&&t.targetTouches[0].target===f&&(F=t.targetTouches[0].pageX,E=t.targetTouches[0].pageY,"BODY"===f.offsetParent.tagName.toUpperCase()?(F-=f.offsetLeft,E-=f.offsetTop):(F-=f.offsetParent.offsetLeft,E-=f.offsetParent.offsetTop),l.clearRect(0,0,f.width,f.height),W(),T(),StickStatus.xPosition=F,StickStatus.yPosition=E,StickStatus.x=((F-m)/v*100).toFixed(),StickStatus.y=((E-C)/v*100*-1).toFixed(),StickStatus.cardinalDirection=D(),i(StickStatus))},!1),document.addEventListener("touchend",function(t){k=0,h&&(F=m,E=C);l.clearRect(0,0,f.width,f.height),W(),T(),StickStatus.xPosition=F,StickStatus.yPosition=E,StickStatus.x=((F-m)/v*100).toFixed(),StickStatus.y=((E-C)/v*100*-1).toFixed(),StickStatus.cardinalDirection=D(),i(StickStatus)},!1)):(f.addEventListener("mousedown",function(t){k=1},!1),document.addEventListener("mousemove",function(t){1===k&&(F=t.pageX,E=t.pageY,"BODY"===f.offsetParent.tagName.toUpperCase()?(F-=f.offsetLeft,E-=f.offsetTop):(F-=f.offsetParent.offsetLeft,E-=f.offsetParent.offsetTop),l.clearRect(0,0,f.width,f.height),W(),T(),StickStatus.xPosition=F,StickStatus.yPosition=E,StickStatus.x=((F-m)/v*100).toFixed(),StickStatus.y=((E-C)/v*100*-1).toFixed(),StickStatus.cardinalDirection=D(),i(StickStatus))},!1),document.addEventListener("mouseup",function(t){k=0,h&&(F=m,E=C);l.clearRect(0,0,f.width,f.height),W(),T(),StickStatus.xPosition=F,StickStatus.yPosition=E,StickStatus.x=((F-m)/v*100).toFixed(),StickStatus.y=((E-C)/v*100*-1).toFixed(),StickStatus.cardinalDirection=D(),i(StickStatus)},!1)),W(),T(),this.GetWidth=function(){return f.width},this.GetHeight=function(){return f.height},this.GetPosX=function(){return F},this.GetPosY=function(){return E},this.GetX=function(){return((F-m)/v*100).toFixed()},this.GetY=function(){return((E-C)/v*100*-1).toFixed()},this.GetDir=function(){return D()}};


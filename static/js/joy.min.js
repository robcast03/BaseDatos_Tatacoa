let isMoving = false;
let ruedas = 0;
let direccion = 0;

function toggleSliderActive(active) {
    slider.disabled = !active;
    sliderValue.disabled = !active;
}

function updateRuedas(value) {
    ruedas = value;
    console.log("Ruedas:", ruedas);
}

function handleKeydown(event) {
    switch (event.key) {
        case 'w':
        case 's':
        case 'a':
        case 'd':
        case 't':
        case 'h':
            direccion = event.key;
            isMoving = true;
            console.log("direccion:", direccion);
            toggleSliderActive(true);
            break;
        case ' ':
            direccion = 0;
            isMoving = false;
            slider.value = 0;
            updateRuedas(0);
            sliderValue.value = 0;
            toggleSliderActive(false);
            break;
        default:
            return;
    }
    sendDataToPython();
}

slider.addEventListener('input', function() {
    if (isMoving) {
        sliderValue.value = this.value;
        updateRuedas(this.value);
    } else {
        this.value = 0;
        sliderValue.value = 0;
        updateRuedas(0);
    }
    sendDataToPython();
});

sliderValue.addEventListener('input', function() {
    if (isMoving) {
        slider.value = this.value;
        updateRuedas(this.value);
    } else {
        this.value = 0;
        updateRuedas(0);
    }
    sendDataToPython();
});

document.addEventListener('keydown', handleKeydown);

function sendDataToPython() {
    const data = {
        direccion: direccion,
        ruedas: ruedas
    };
    console.log("Enviando datos:", data);
    fetch('/receive_data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => console.log("Respuesta del servidor:", data))
    .catch(error => console.error('Error:', error));
}
